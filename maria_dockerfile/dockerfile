# Base Image
FROM mariadb:latest

# Set environment variables (you can override these at runtime if needed)
ENV MARIADB_APP_PASSWORD=defaultAppPassword
ENV MARIADB_DEVELOPER_PASSWORD=defaultDevPassword

# Working directory for the script
WORKDIR /docker-entrypoint-initdb.d

# Copy and create the init.sql file
RUN echo "\
CREATE DATABASE IF NOT EXISTS db;\n\
CREATE USER IF NOT EXISTS 'app_user'@'%' IDENTIFIED BY '${MARIADB_APP_PASSWORD}';\n\
CREATE USER IF NOT EXISTS 'developer'@'%' IDENTIFIED BY '${MARIADB_DEVELOPER_PASSWORD}';\n\
GRANT ALL PRIVILEGES ON db.* TO 'app_user'@'%';\n\
GRANT SELECT ON db.* TO 'developer'@'%';\n\
FLUSH PRIVILEGES;\n\
" > init.sql

# Confirm that the file was created
RUN echo "init.sql generated successfully: " && cat init.sql

# Expose the database port
EXPOSE 3306

# Use the MariaDB default entrypoint
CMD ["mariadbd"]

